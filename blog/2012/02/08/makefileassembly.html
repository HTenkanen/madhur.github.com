<!DOCTYPE html>

<html lang="en">
<head>
   <meta charset="utf-8" />
   <title>Using MakeFile with Assembly Programming &#8211; Madhur Ahuja</title>
   <meta name="author" content="Madhur Ahuja" />
   
    
		<meta name="description" content=" Using MakeFile with Assembly Programming" />
	

    <link rel="start" href="/" />

	
	
  	<link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
	<link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />
   
	<link rel="stylesheet" href="/files/css/blueprint/screen.css" type="text/css" />   	
	<!--<link rel="stylesheet" href="/files/css/disqus-form.css" type="text/css" /> -->
	
	<!--<link rel="stylesheet" href="/files/css/syntax.css" type="text/css" />-->
	<link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
	<link rel="stylesheet" href="/files/css/jquery.fancybox.css" type="text/css" />
	
	<link rel="stylesheet" type="text/css" href="/files/css/styles.css" />
	
	
		<link rel="stylesheet" type="text/css" href="/files/css/syntax.css" />
	
			
   <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css">
   
   
	<script src="/files/js/jquery.js" type="text/javascript"></script>	
	<script src="/files/js/jquery.fancybox.pack.js" type="text/javascript"></script>
	
	<!--[if lt IE 9]>
		<script src="/files/js/modernizr-2.5.3.js" type="text/javascript"></script>
	<![endif]-->
	
	<script type="text/javascript">
	var disqus_iframe_css = 'http://madhur.co.in/files/css/disqus-form.css';
	</script>
	
	
	<script src="/files/js/URI.js" type="text/javascript"></script>
	<script src="/files/js/site.js" type="text/javascript"></script>
	
	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-23769089-1']);
	  _gaq.push(['_trackPageview']);

	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>
		
	
</head>
<body>
<div id="gradient">
	<div id="container" class="container">
		<header id="header" class="span-24 last">

			<div id="logo">
<ul>
<li><a href="http://www.linkedin.com/in/madhurahuja"><img src="/images/linkedinhigh.png" /></a></li>
<li><a href="https://github.com/madhur"><img src="/images/github_32.png"/></a></li>
<li><a href="http://feeds.feedburner.com/madhur"><img src="/images/rsshigh.png" /></a></li>
</ul>
</div>


<nav id="navigation">
				<ul id="nav">
					<li><a class="madhur" href="/">Madhur Ahuja</a></li>
					<li><a class="home" href="/">Home</a></li>
					<li><a class="blog" href="/blog">Blog</a></li>
					<!--<li><a class="work" href="/work">Resume</a></li>-->
					<li><a class="code" href="/projects">Projects</a></li>
					<!--<li><a class="papers" href="/papers">Papers</a></li>--> 
					<li><a class="info" href="/info">About</a></li>
					<li><a class="contact" href="/contact">Contact</a></li>

				</ul>
				
				
</nav>
<div class="c">
&nbsp;
</div>



		</header>
		<div id="content" class="span-24 last">

			<section id="primary" class="span-24 last">

	<div id="blogcontent">

		<aside class="postmeta full span-5">

			<div class="timestamp">
	<time datetime="2012-02-08 00:00:00 +0530" pubdate="pubdate">08 February 2012</time>

	<br>
	<span pubdate="pubdate" class="time">8:00 PM</span>
</div> 

<div class="actions">
<ul> 
								<li><a href="/blog/2012/02/08/makefileassembly.html#disqus_thread" data-disqus-identifier="/2012/02/08/makefileassembly/" class="comment">View Comments</a></li> 

<script type="text/javascript">

	var disqus_developer = 0;
		var disqus_shortname = 'madhur';
		var disqus_iframe_css = "http://madhur.github.com/css/screen.css";
			var links = document.getElementsByTagName('a');
			var query = '?';
			
					query += 'url=' + encodeURIComponent(window.location.href) + '&';
					//alert(query);
				
			
	document.write('<script type="text/javascript" src="http://disqus.com/forums/madhur/get_num_replies.js?url2=' + encodeURIComponent(window.location.url) + '#disqus_thread"></' + 'script>');
	

</script>


								<li><span class="share" title="Click to expand">share this post</span> 
									<ul class="sharing" style="display:none"> 
										<li class="first"><a href="http://blinklist.com/index.php?Action=Blink/addblink.php&amp;Url=/blog/2012/02/08/makefileassembly.html&amp;Title=Using MakeFile with Assembly Programming" id="share_blinklist" title="Share on BlinkList" rel="nofollow">BlinkList</a></li> 
										<li><a href="http://del.icio.us/post?url=http://madhur.co.in/blog/2012/02/08/makefileassembly.html&amp;title=Using MakeFile with Assembly Programming" id="share_delicious" title="Add to del.icio.us" rel="nofollow">del.icio.us</a></li> 
										<li><a href="http://digg.com/submit?url=http://madhur.co.in/blog/2012/02/08/makefileassembly.html" id="share_digg" title="Digg This!" rel="nofollow">Digg</a></li> 
										<li><a href="http://www.facebook.com/share.php?u=http://madhur.co.in/blog/2012/02/08/makefileassembly.html" id="share_facebook" title="Share on Facebook" rel="nofollow">Facebook</a></li> 
										<li><a href="http://reddit.com/submit?url=http://madhur.co.in/blog/2012/02/08/makefileassembly.html&amp;title=Using MakeFile with Assembly Programming" id="share_reddit" title="Share on Reddit" rel="nofollow">Reddit</a></li> 
										<li><a href="http://www.stumbleupon.com/submit?url=http://madhur.co.in/blog/2012/02/08/makefileassembly.html&amp;title=Using MakeFile with Assembly Programming" id="share_stumbleupon" title="Share on StumbleUpon" rel="nofollow">StumbleUpon</a></li> 
										<li><a href="http://twitter.com/home?status=http://madhur.co.inUsing MakeFile with Assembly Programming%3A%20/blog/2012/02/08/makefileassembly.html" id="share_twitter" title="Tweet this!" rel="nofollow">Twitter</a></li> 
										<li class="last"><a href="http://www.technorati.com/faves?add=http://madhur.co.in/blog/2012/02/08/makefileassembly.html" id="share_technorati" title="Favourite on Technorati" rel="nofollow">Technorati</a></li> 
									</ul> 
								</li> 
								<li><a href="http://feeds.feedburner.com/madhur" class="subscribe">subscribe to this blog</a></li> 
								
								<li><a href="javascript:Clickheretoprint()" class="subscribe">print this page</a></li> 								
								<li><a href="/blog/2012/02/08/makefileassembly.html" class="permalink">permalink</a></li> 
															</ul> 

</div>

<div class="category">
<h3>Advert</h3>
	<script type="text/javascript"><!--
google_ad_client = "ca-pub-1657163894706869";
/* madhur.co.in right side */
google_ad_slot = "3156850124";
google_ad_width = 160;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>


</div>


		</aside>

		<article class="post full span-18 last">
					<header><h1>Using MakeFile with Assembly Programming</h1></header>
			 <p>I have been a big fan of assembly programming since my old school days. The raw power of CPU which you get is just pure awesome.
But, with that power, you also get much headache of non-availablity of standard IDEâ€™s for using Assembly language.</p>

<ul>
  <li>
    <p>Visual Studio is one of the options, but it restricts you to the installed version of Microsoft Macro Assembler (ml.exe)</p>
  </li>
  <li>
    <p>Some prefer using QEditor.exe which ships with <a href="http://masm32.com">MASM32 SDK</a></p>
  </li>
  <li>
    <p>Some like me, just cannot stay away from there favourite editors such as Notepad++, Ultraedit etc.</p>
  </li>
</ul>

<p>The benefit of using editors such as Notepad++, Ultraedit is that you get fully customizable syntax highlighting and command line tools
to be used while assembling and linking their programs. However, with these tools you have to add commands to both assemble and link your programs. And if you are like me,
who fiddles with 16bit, 32bit and 64 bit assembly programs, you have to add seperate commands for them. And not to forget, seperate commands for outputting debug and release binaries as well.</p>

<p>To simplify the above process, I have been exploring the use of makefiles to assemble and link my programs and this has worked wonderfully well. I just maintain my each assembly project in seperate directory with the makefile
and use that as a command to assembly and link the program from <a href="http://notepad-plus-plus.org/">Notepad++</a>, using <a href="https://sourceforge.net/projects/npp-plugins/files/NppExec/">NppExec plugin</a>. Apart from Notepad++, I am using following tools as my development environment. You might be using different, but they can be applied in same concept.</p>

<ol>
  <li>NMAKE(nmake.exe) v10.00.30319.01 which ships with Visual Studio 2010 available <a href="http://www.microsoft.com/visualstudio/en-in">here</a></li>
  <li>Borland Resource compiler (brcc32.exe) v4.50 which ships with Borland compiler tools available somewhere on the net</li>
  <li>Microsoft Macro Assembler(ml.exe) v6.14 and Linker (link.exe) v5.12 which ships with Masm 32 SDK available <a href="http://www.masm32.com/">here</a></li>
</ol>

<p>Note that all the above tools should be put preferable in the PATH variable for easy access. I do this by creating a simple command script as follows:</p>

<div class="highlight"><pre><code class="text">setx PATH &quot;f:\common tools\git\bin;f:\common tools\python\app;f:\common tools\python\app\scripts;f:\common tools\ruby\bin;f:\masm32\bin;F:\Borland\BCC55\Bin;&quot;
</code></pre></div>

<p>I am going to show you some scenarios here on how I am using Makefiles to assemble and link my programs. Note that this is not a tutorial for using makefiles. I assume you have some basic familiarity with it. </p>

<ul>
  <li>A Win32 Assembly program without the use of resources:</li>
</ul>

<div class="highlight"><pre><code class="makefile"><span class="nv">MASMPATH</span><span class="o">=</span>F:<span class="se">\M</span>ASM32
<span class="nv">ML</span><span class="o">=</span>ml
<span class="nv">DEBUG</span> <span class="o">=</span> 1
<span class="err">!IF</span> <span class="k">$(</span>DEBUG<span class="k">)</span><span class="o">==</span>1
<span class="nv">CFLAGS</span><span class="o">=</span>/c /coff /Zd /Zi /Fl /Sn /nologo /I
!ELSE
<span class="nv">CFLAGS</span><span class="o">=</span>/c /coff /Fl /Sn /nologo /I
!ENDIF
<span class="nv">LDFLAGS</span><span class="o">=</span>
<span class="nv">SOURCES</span><span class="o">=</span>trans.asm
<span class="nv">OBJECTS</span><span class="o">=</span><span class="k">$(</span>SOURCES:.asm<span class="o">=</span>.obj<span class="k">)</span>
<span class="nv">PROJ</span><span class="o">=</span>trans.exe


<span class="k">$(</span>PROJ<span class="k">)</span>: <span class="k">$(</span>OBJECTS<span class="k">)</span>
	link /NOLOGO /SUBSYSTEM:WINDOWS /LIBPATH:<span class="k">$(</span>MASMPATH<span class="k">)</span><span class="se">\L</span>IB <span class="k">$(</span>OBJECTS<span class="k">)</span>
	
<span class="k">$(</span>OBJECTS<span class="k">)</span>: <span class="k">$(</span>SOURCES<span class="k">)</span>
	<span class="k">$(</span>ML<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>MASMPATH<span class="k">)</span><span class="se">\i</span>nclude <span class="k">$(</span>SOURCES<span class="k">)</span> 
	
clean:
	del *.exe
	del *.obj
	del *.lst
</code></pre></div>

<ul>
  <li>A win32 Assembly program with the use of resources:</li>
</ul>

<div class="highlight"><pre><code class="makefile"><span class="nv">MASMPATH</span><span class="o">=</span>F:<span class="se">\M</span>ASM32
<span class="nv">ML</span><span class="o">=</span>ml
<span class="nv">DEBUG</span> <span class="o">=</span> 1
<span class="err">!IF</span> <span class="k">$(</span>DEBUG<span class="k">)</span><span class="o">==</span>1
<span class="nv">CFLAGS</span><span class="o">=</span>/c /coff /Zd /Zi /Fl /Sn /nologo /I
!ELSE
<span class="nv">CFLAGS</span><span class="o">=</span>/c /coff /Fl /Sn /nologo /I
!ENDIF
<span class="nv">LDFLAGS</span><span class="o">=</span>
<span class="nv">SOURCES</span><span class="o">=</span>vaoffset.asm
<span class="nv">RESOURCES</span><span class="o">=</span>vaoffset.rc
<span class="nv">OBJECTS</span><span class="o">=</span><span class="k">$(</span>SOURCES:.asm<span class="o">=</span>.obj<span class="k">)</span> vaoffset.res
<span class="nv">PROJ</span><span class="o">=</span>vaoffset.exe


<span class="k">$(</span>PROJ<span class="k">)</span>: <span class="k">$(</span>OBJECTS<span class="k">)</span>
	link /NOLOGO /SUBSYSTEM:WINDOWS /LIBPATH:<span class="k">$(</span>MASMPATH<span class="k">)</span><span class="se">\L</span>IB /LIBPATH:f:<span class="se">\p</span>rojects<span class="se">\p</span>rograms<span class="se">\w</span>insock<span class="se">\n</span>etsend <span class="k">$(</span>OBJECTS<span class="k">)</span>
	
<span class="k">$(</span>OBJECTS<span class="k">)</span>: <span class="k">$(</span>SOURCES<span class="k">)</span>
	<span class="k">$(</span>ML<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>MASMPATH<span class="k">)</span><span class="se">\i</span>nclude <span class="k">$(</span>SOURCES<span class="k">)</span> 
	C:<span class="se">\B</span>orland<span class="se">\B</span>CC55<span class="se">\B</span>in<span class="se">\b</span>rcc32.exe vaoffset.rc
	
	
clean:
	del *.exe
	del *.obj
	del *.lst
	
</code></pre></div>

<p>Now, Provided <strong>NMAKE</strong> is in your path variable, you can simply set a command in Notepad++ or in your favourite text editor to invoke nmake in current directory.</p>

<div class="highlight"><pre><code class="text">F:\projects\programs\WIN32ASM\transparent&gt;nmake /U

Microsoft (R) Program Maintenance Utility Version 10.00.30319.01
Copyright (C) Microsoft Corporation.  All rights reserved.

        ml /c /coff /Zd /Zi /Fl /Sn /nologo /I F:\MASM32\include trans.asm
 Assembling: trans.asm
        link /NOLOGO /SUBSYSTEM:WINDOWS /LIBPATH:F:\MASM32\LIB trans.obj
</code></pre></div>

<p>And to clean the output,</p>

<div class="highlight"><pre><code class="text">F:\projects\programs\WIN32ASM\transparent&gt;nmake clean

Microsoft (R) Program Maintenance Utility Version 10.00.30319.01
Copyright (C) Microsoft Corporation.  All rights reserved.

        del *.exe
        del *.obj
        del *.lst		
</code></pre></div>


			<footer>
				<div class="blocked tags">
					<p>
					
						<a href="/tags/assembly">Assembly</a> |
					
						<a href="/tags/masm">MASM</a> |
					
					</p>
				</div>
			</footer>
			
			<br/>
			<div>


				<!-- Enable Google Plus comments -->
				<!-- Place this tag where you want the +1 button to render -->
<div class="social">
<g:plusone></g:plusone>

<a href="https://twitter.com/share" class="twitter-share-button" data-via="madhur25">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<fb:like href="http://madhur.co.in/blog/2012/02/08/makefileassembly.html" send="true" layout="button_count" width="450" show_faces="true" colorscheme="dark" font="lucida grande"></fb:like>
</div>


<!-- Place this tag after the last plusone tag -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>


			</div>
			
			
			<div class="hr"></div>

		


			<!-- Discus Comments -->
			<div id="disqus_thread"></div>

			
			<!-- Enable Disqus comments -->
			<script type="text/javascript">
  var disqus_developer = 0; // developer mode is on
  var disqus_shortname = 'madhur';
  var disqus_identifier = '/2012/02/08/makefileassembly/';
  var disqus_title = 'Using MakeFile with Assembly Programming';
  var disqus_url = 'http://madhur.co.in/blog/2012/02/08/makefileassembly.html';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script>

			
			
			

		</article>

		<div class="c">&nbsp;</div>

	</div>

	
</section>
 
<div class="c">&nbsp;</div>


  
<script type="text/javascript">
    
    var disqus_shortname = 'madhur'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

 

 



		</div>
		  
		<footer id="footer" class="span-24 last">
			
				<p id="copyright">
					&copy; 2011-2014
					Madhur Ahuja
				</p>
				<p id="poweredby">
					Powered by 
					<a href="http://jekyllrb.com" title="A static, minimalist CMS">Jekyll</a>, <a href="http://github.com/">Github</a> and <a href="http://disqus.com">Disqus</a>.
				</p>

				<div class="c">&nbsp;</div>

			
		</footer>

	</div>

</div>

</body>
</html>
